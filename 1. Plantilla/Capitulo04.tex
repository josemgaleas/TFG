%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Documento LaTeX 																						%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Título:		Capítulo 3
% Autor:  	Ignacio Moreno Doblas
% Fecha:  	2014-02-01, actualizado 2019-11-11
% Versión:	0.5.0
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% !TEX root = A0.MiTFG.tex

\chapterbegin{Fundamentos teóricos}
\label{chp:App}
\minitoc

\section{Introducción a los esquemas de señalización}
%Hablar sobre qué són los esquemas de señalización y cual es su función principal. comentar
%los esquemas (alternos,cancelación,4ppm,4ippm y pwm) y por qué se han elegido o descartado.
%Decir que no son los esquemas del estándar y que se han elegido para investigar sus ventajas e inconvenientes. 

En el ámbito de la comunicación existen múltiples esquemas de codificación digital con diferentes propiedades como 
probabilidad de bit, ciclo de trabajo, ancho de banda, etc. A la hora de estudiar un esquema de codificación para hacer 
su elección hay que tener en cuenta tres aspectos fundamentales, que son:
\begin{itemize}
    \item Flickering: se define como el cambio de la luz provocado por la conmutación entre encendido 
y apagado (1 y 0) en intervalos muy cortos. 
Estos parpadeos, si se producen a una velocidad perceptible por el ojo humano, pueden llegar a ser molestos y causar dolor. 
    \item Rendimiento óptico.
    \item La capacidad para controlar la atenuación o el dimming, provocado por por la variación de la intensidad de la luz, 
    en esquemas de codificación con ancho de pulso de la señal variable. 
\end{itemize} 

El estándar de comunicaciones por luz visible IEEE 802.15.7 usa como esquema de señalización la codificación Manchester. 
Continuando con el estudio de los esquemas de señalización,
a continuación, se van a desarrollar otras opciones de esquemas de codificación con características diferentes
para estudiar su eficacia e impacto en las comunicaciones por luz visible.
Los esquemas a desarrollar son codificación por pulsos alternos, cancelación de pulsos y 4-ppm. También se hará una 
comparativa de 4-ppm frente a Inverse 4-ppm para comparar sus prestaciones y el efecto de transmitir mayor cantidad 
de ``unos'' que de ``ceros''.

Es importante destacar que en un primer momento también se planteó el desarrollo de codificación 4-PWM pero se descartó su 
implementación debido a su escasa capacidad para controlar el dimming. Esto provocaba que la intensidad de la luz 
fluctuara mucho a lo largo de una transmisión siendo perceptible y molesto para el ojo humano.

\section{Pulsos alternos}
% Comentar teóricamente en que consiste este esquema (miller pero con una opción menos y alternando).
% Y que apenas está implementado y desarrollado en ningún sitio.
El primer esquema de codificación desarrollado es pulsos alternos. Este esquema 
se puede considerar como una versión de la codificación Manchester pero
añadiendo tiempos de silencio. Estos tiempos de silencio añadidos en la transmisión
se emplean para diseñar formatos OOK con memoria mediante el uso de de la alternancia de
posición de pulsos. Lo que proporciona una mejora notable en el rendimiento y una 
configuración del espectro favorable. 
Este formato de pulsos alternos tiene un ciclo de trabajo bajo, lo que provoca que esta 
codificación sea ventajosa en términos de modulación de intensidad y detección directa. 
En este esquema, utilizamos los tiempos de silencio y los pulsos alternos para
modificar las estadísticas de la secuencia de amplitud con respecto a las estadísticas de 
la secuencia de mensajes.

De esta manera, el bit de información '0' siempre se codifica con la ausencia de pulso 
'00', mientras que el bit '1' se representa con un pulso que va variando su posición con
cada transmisión del '1'. Gracias a aplicar este esquema, se reduce el número de pulsos 
transmitidos en otros esquemas de señalización como Manchester o Miller.

%Dibujar y comentar el diagrama de trellis de este esquema
La figura \ref{trellis_alternos} representa el diagrama de Trellis de este esquema de 
codificación tal y como se ha descrito anteriormente. Este modelo consiste en dos estados,
imprescindibles para la alternancia de pulsos. Lo más destablace del diagrama es que 
siempre que se codifica un '0' nos mantenemos en el mismo estado y siempre que se 
codifca un '1' cambiamos de estado para realizar la alternancia de pulsos. Será en el 
momento de cambio de estado cuando codificaremos el pulso correspondiente que dependerá 
del estado al que se transicione.
\vspace{1cm}

\begin{figure}[ht]
    \centering
    \input{./figuras/alternos.tikz}
    \caption{\small{Diagrama de Trellis de la codificación pulsos alternos.}}
    \label{trellis_alternos}%
\end{figure}

El esquema de señalización resultante se muestra en la figura \ref{codificacion_alternos}.

%% INSERTAR FIGURA DE LA CODIFICACIÓN
\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.5]{./figuras/CodificadaAlternos.pdf}
    \caption{\small{Codificación con pulsos alternos.}}
    \label{codificacion_alternos}%
\end{figure}

En dicha figura se observa perfectamente el funcionamiento de este esquema de 
señalización. En la parte superior de la figura se encuentra la trama pseudoaleatoria y 
abajo su codificación en la que se muestra como los pulsos alteran en cada codificación 
de '1' y que siempre se que codifica un '0' hay ausencia de pulsos. Además, la señal 
codificada se encuentra entre -1V y 1V lo que implica que ya está preparada para ser 
transmitida por el canal de luz. La señal codificada trabaja a el doble de frecuencia que 
la señal de entrada ya que hay transiciones rápidas cuando se transmite un pulso al igual
que ocurre con la codificación Manchester que especifica el estándar.

Además, también se observa que el ciclo de trabajo es bajo cuya ventaja, como se ha 
comentado anteriormente, es que proporciona mayor intensidad de iluminación cuando se 
transmite un pulso. Sin embargo, también tiene una desventaja que va ligada al flickering.
Al tranmsitir mayor cantidad de '0' que de '1' el transmisor se encuentra más tiempo 
apagado por lo que el parpadeo es más notable para el ojo humano que en otras 
codificaciones como Manchester o Miller por lo que se necesitará una frecuencia de 
transmisión mayor para este esquema de señalización para que el flickering no sea 
perceptible por el ojo humano y llegue a ser molesto.

% Por qué es un esquema no equiprobable haciendo los cálculos correspondientes.
Este esquema al tener mayor número de '0' que de '1' se convierte en un esquema no 
equiprobable, es decir, en un esquema que no tiene la misma probabilidad de transmitir 
'0' que '1'. Es importante realizar los cálculos correspondientes para conocer la 
probabilidad exacta de cada bit para conocer el ciclo de trabajo y el efecto que 
provoca en el receptor óptico la no equiprobabilidad.
%%%%%%%%%%%%%%%%%%%% FORMULA DE LA PROBABILIDAD %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% BER 
Se han estudiado sus prestaciones para tener una idea de cómo funciona este esquema. 
El funcionamiento depende del sistema de decisión que se aplique (estos sistemas de 
explican en el apartado 4.6) pero es bueno tener una visión de su tasa de error de bit.
La figura x muestra la tasa de error de bit (BER) en función de la relación señal a ruido
(SNR) de esque esquema de señalización aplicando \textit{soft-decoding} como sistema de 
decisión. 
%%%%%%%%%%%%%%%%%%% FOTO DE BER SOFT-DECODING %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Seguidamente, podemos calcular la densidad de potencia espectral (PSD) de la 
codificación propuesta aplicando la siguiente fórmula.
% Calculo del psd en el paper que me pasó Antonio
%%%%%%%%%%%%%%%%%% FORMULA PSD %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

La densidad de potencia espectral obtenida a través de los cálculos
anteriores se muestra en la figura \ref{psd_alternos}
%%%%%%%% FOTO DEL PSD DEL PAPER DE ANTONIO %%%%%%%%%%%%%%%%
\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.5]{./figuras/psd_alternos.png}
    \caption{\small{Potencia espectral frente a frecuencia normalizada.}}
    \label{psd_alternos}%
\end{figure}

% CONCLUSION 
En definitiva, se ha propuesto una nueva técnica de codificación basada en la 
alternancia de pulsos y en la ausencia de los mismos para modificar las estadísticas de la
secuencia de amplitud con respecto a las estadísticas de la secuencia de mensajes llevando
a una mejora notable para el formato OOK con un rendimiento óptimo.

\section{Cancelación de pulsos}
% Comentar teóricamente en que consiste este esquema (alternos pero eliminando pulsos).
% Y que apenas está implementado y desarrollado en ningún sitio.

Tras el desarrollo de la codificación por pulsos alternos y de haber visto mejora en 
términos de BER, la ventaja proporcionada por modificar las estadísticas de la secuencia
no se explotan completamente ya que la técnica de señalización no presenta ninguna mejora
respecto a la relación de potencia óptica de pico a promedio (PAOPR), y por lo tanto aún
se pueden conseguir mejores resultados. Siguiendo esta línea, para mejorar el pico de 
potencia óptica se trata de disminuir el número de pulsos, centrándose en evitar la 
aparición de más de un pulso de manera consecutiva. 

De esta manera, el bit de información '1' se codifica con la ausencia de pulso '00' 
o con un pulso con su posición modificada, '01'. Mientras que el bit '0' se representa con
ausencia de pulso '00' o con presencia de pulso sin modificar su posición '10'. Gracias
a aplicar esto, se disminuyen los números de pulsos de una manera bastante notable. 

%EXPLICAR EL TRELLIS
La figura \ref{trellis_cancelacion} representa el diagrama de Trellis de este esquema
de codificación tal y como se ha descrito anteriormente. Este modelo consiste en tres 
estados, donde cada estado es imprescindible para saber como codificar el dato.
Lo más importante del trellis es que el primer '1' que se codifica después de un '0'
siempre se codifica como ausencia de pulso ('00') y que siempre que el bit de dato
es un '0' se transiciona al estado S1 para volver a empezar y codificar el primer '1'
como ausencia de pulso. También se observa que después de codificar el primer '1' es 
cuando se produce el pulso con su posición modificada si se codifica otro '1' o el 
pulso con su posición sin modificar si se codifica un '0'.
Hay que destacar que el estado S3 funciona exactamente igual que el estado S1 pero,
sin embargo, es necesario por la naturaleza de los diagramas de Trellis o de Markov, 
ya que no es apropiado que se transicione al mismo estado independientemente del bit 
que se codifique.
\vspace{1cm}

\begin{figure}[ht]
    \centering
    \input{./figuras/cancelacion.tikz}
    \caption{\small{Diagrama de Trellis de la codificación cancelación de pulsos.}}
    \label{trellis_cancelacion}%
\end{figure}

El esquema de señalización resultante se muestra en la figura \ref{codificación_cancelacion},
donde se puede observar una mejora del 50\% en PAOPR. Ya que este formato asegura un 
período mínimo de tiempo sin transiciones consecutivas.

%% INSERTAR FIGURA DE LA CODIFICACIÓN
\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.6]{./figuras/CodificadaCancelacion.pdf}
    \caption{\small{Codificación con cancelación de pulsos.}}
    \label{codificación_cancelacion}%
\end{figure}

Además, en dicha figura, se puede apreciar el funcionamiento de este esquema de señalización 
ya que se comprueba que predomina la ausencia de pulsos. En la parte superior de la figura 
se encuentra la trama pseudoaleatoria y abajo su codificación. También se 
observa como la entrada es una señal digital (0 y 1) y como la codificada se encuentra
entre [-1,1] que es el rango de transmisión por el canal de luz.

En este esquema de codificación, la señal codificada tiene el doble de frecuencia de 
trabajo ya que, al igual que otros esquemas como pulsos alternos o Manchester, hay 
transiciones rápidas entre '0' y '1'. 

En la figura también se observa que el ciclo de trabajo de esta codificación es 
bajo porque hay pocos pulsos. Esto provoca dos efectos.
\begin{itemize}
    \item Flickering: al transmitir mayor número de '0' que de '1' la fuente transmisora
        se encuentra más tiempo apagada que encendida. Esto implica que, a la misma 
        frecuencia de transmisión que otros esquemas de codificación, el flickering en 
        cancelación de pulsos sea mayor ya que es uno de los esquemas que mayor 
        diferencia de probabilidad de bits presenta.
    \item Potencia óptica: la ventaja de transmitir pocos pulsos es que estos se pueden 
        transmitir con mayor potencia ya que el transmisor está la mayor parte del tiempo
        sin transmitir. 
\end{itemize}

% Por qué es un esquema no equiprobable haciendo los cálculos correspondientes.
Como se ha explicado anteriormente, este esquema prioriza la ausencia de pulsos por
lo que también es un esquema no equiprobable (no tiene la misma probabilidad de '0'
que de '1'), aunque en mayor medida que en pulsos
alternos ya que en este hay mayor presencia de '0'. Para saber cuales son sus 
probabilidades exactas hay que realizar los cálculos correspondientes. Este cálculo es 
imprescindible para, además de conocer el ciclo de trabajo, conocer el efecto que 
produce en el receptor de luz.
%%%%%%%%%%%%%%%%%%%% FORMULA DE LA PROBABILIDAD %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Al igual que para pulsos alternos, se han estudiado sus prestaciones en función de varios 
sistemas de decisión. Estos sistemas se explicarán en el apartado 4.6 pero es oportuno 
tener una referencia de su tasa de error de bit para tener una idea inicial de sus 
prestaciones. Para ello, la figura x muestra la tasa de error de bit de este esquema
para una trama pseudoaleatoria aplicando \textit{soft-decoding} como sistema de decisión. 
%%%%%%%%%%%%%%%%%%% FOTO DE BER SOFT-DECODING %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A continuación, podemos calcular la densidad de potencia espectral (PSD) de la 
codificación propuesta aplicando la siguiente fórmula.
% Calculo del psd en el paper que me pasó Antonio
%%%%%%%%%%%%%%%%%% FORMULA PSD %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Por consiguiente, la densidad de potencia espectral obtenida a través de los cálculos
anteriores se muestra en la figura \ref{psd_cancelación}.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.5]{./figuras/psd_cancelacion.png}
    \caption{\small{Potencia espectral frente a frecuencia normalizada.}}
    \label{psd_cancelación}%
\end{figure}


% CONCLUSION 
En conclusión, este esquema de codificación propuesto basado en la ausencia de pulsos
mejora notablemente la codificación de la señal.
El aumento de los tiempos de silencio se utilizan para modificar las estadísticas de
la secuencia de amplitud con respecto a las estadísticas de la
secuencia de mensajes, lo que permite el aumento de la PAOPR,
que es una característica favorable en enlaces ópticos. De esta manera se 
obtiene una buena compensación entre rendimiento y complejidad requerida.

\section{4-PPM}
Explayarme mucho más porque hay mucha más información.
Comentar teóricamente en que consiste este esquema.
Y que apenas está implementado y desarrollado en ningún sitio.

Dibujar y comentar el diagrama de trellis de este esquema para la codificación/decodificación de la señal.

si encuentro algo hablar sobre cual es su espectro y las diferencias respecto a los del estándar

Desarrollar por qué es un esquema no equiprobable haciendo los cálculos correspondientes.

Comentar si se encuentra la ber y sus prestaciones

\section{Comparativa 4-PPM frente a Inverse 4-PPM}
Comparar estos dos esquemas y comentar ventajas e inconvenientes.
%https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6614862
%https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=567560&tag=1

\section{Sistemas de decisión}
%Hablar sobre las técnicas usadas --> hard-decoding, soft-decoding y algoritmo de Viterbi
%Tener en cuenta el mapeo que se realiza para poner la señal en el rango [-8192,8191]
En este apartado se van a describir los diferentes sistemas de decisión para interpretar la señal recibida de la mejor 
manera posible que se han implementado. Para ello, se van a desarrollar 
sus características más representativas así como sus ventajas e inconvenientes.

\subsection{Hard-decoding}


\subsection{Soft-decoding}
aaaaaaaaaa
aaaaaaaaaa

aaaaaaaa
\subsection{Algoritmo de Viterbi}

% \begin{figure}[htbp]
%     \centering
%     \includegraphics[scale=0.75]{./figuras/Viterbi_pulsos_cancelacion.pdf}
%     \caption{\small{Viterbi.}}
%     \label{Viterbi}%
% \end{figure}

\subsection{Comparativa entre los sistemas de decisión}
A continuación, se va a comparar la tasa de error de bit (BER) de los distintos esquemas de decisión, para cada esquema 
de codificación, en función de la relación señal a ruido (SNR), que varia con la distancia (disminuyendo la 
amplitud de la señal), para verificar la mejora que se produce entre cada sistema de decisión.

Para pulsos alternos, la principal mejora se nota con la aplicación del algoritmo de Viterbi.

Para cancelación de pulsos la aplicación del algoritmo de Viterbi es muy importante ya que, como se comentó anteriormente,
se descartan muchas opciones al mirar un pasado.

Para 4ppm el uso de soft-decoding implica una gran mejora debido a la posibilidad de buscar el bit mayor ya que solo 
se recibe un '1' por cuarteto de bits.

%%FOTOS DE ALTERNOS (HARD,SOFT,VITERBI), CANCELACION (HARD,SOFT,VITERBI) Y 4PPM(HARD,SOFT)

%%%%%%%% NO SE SI PONER UN APARTADO DE COMPARATIVA ENTRE CODIFICACIONES SEGUN EL SISTEMA DE DECISION O PONER LAS FOTOS
%%% DENTRO DE CADA ESQUEMA %%%%%%%%%%%%%%%%%%%%%%%%%%


\chapterend{}
